@using Components
@using Models
@page "/flow"
@* @page "/flow/{State:pageState}" *@
@inject NavigationManager NavigationManager
@rendermode InteractiveServer

<PageTitle>Counter</PageTitle>
@switch (currentState)
{
    case pageState.AskAboutChildren:
    <div>
        <QuestionComponent 
            Text = "Har du, eller har du haft et eller flere børn?" 
            OnYes = "@(() => {currentState = pageState.AddChildren; StateHasChanged();})"
            OnNo = "@(() => {currentState = pageState.AskAboutSpouse; StateHasChanged();})"
            ></QuestionComponent>
        </div>
        break;
    case pageState.AddChildren:
        <div>
            <CreatePersonComponent 
                Inheritants = "@Inheritants"
                Text = "Angiv data for barn/børn"
                OnFinished = "@(() => {currentState = pageState.AskAboutSpouse; StateHasChanged();})"
                OnCancel = "@(() => {currentState = pageState.AskAboutChildren; StateHasChanged();})">
            </CreatePersonComponent>
        </div>
        break;
    case pageState.AskAboutSpouse:
        <div>
        <QuestionComponent 
            Text = "Har du en nulevende ægtefælle?" 
            OnYes = "@(() => {currentState = pageState.AddSpouse; StateHasChanged();})"
            OnNo = "@(() => {currentState = pageState.AskAboutParents; StateHasChanged();})"
            >
        </QuestionComponent>
        </div>
        break;
    case pageState.AddSpouse:
        <div>
            <CreatePersonComponent 
                Inheritants = "@Inheritants"
                Text = "Angiv data for Ægtefælle"
                OnFinished = "@(() => {currentState = pageState.AskAboutParents; StateHasChanged();})"
                OnCancel = "@(() => {currentState = pageState.AskAboutSpouse; StateHasChanged();})">
            </CreatePersonComponent>
        </div>
        break;
    case pageState.AskAboutParents:
    if (Inheritants.Count > 0)
    {
        currentState=pageState.Finished;
        StateHasChanged();
        break;
    }
        <div>
        <QuestionComponent 
            Text = "Har du en eller flere levende forældre?" 
            OnYes = "@(() => {currentState = pageState.AddParents; StateHasChanged();})"
            OnNo = "@(() => {currentState = pageState.AskAboutSiblings; StateHasChanged();})"
            >
        </QuestionComponent>
        </div>
        break;
    case pageState.AddParents:
        <div>
            <CreatePersonComponent 
                Inheritants = "@Inheritants"
                Text = "Angiv data for Forældre"
                OnFinished = "@(() => {currentState = pageState.AskAboutSiblings; StateHasChanged();})"
                OnCancel = "@(() => {currentState = pageState.AskAboutParents; StateHasChanged();})">
            </CreatePersonComponent>
        </div>
        break;
    case pageState.AskAboutSiblings:
        <div>
            <QuestionComponent Text="Har du en eller flere levende biologiske søskende?"
                OnYes="@(() => {currentState = pageState.AddSiblings; StateHasChanged();})"
                OnNo="@(() => {currentState = pageState.AskAboutGrandparents; StateHasChanged();})">
            </QuestionComponent>
        </div>
        break;
    case pageState.AddSiblings:
        <div>
            <CreatePersonComponent 
                Inheritants = "@Inheritants"
                Text = "Angiv data for biologiske søskende"
                OnFinished = "@(() => {currentState = pageState.AskAboutGrandparents; StateHasChanged();})"
                OnCancel = "@(() => {currentState = pageState.AskAboutSiblings; StateHasChanged();})">
            </CreatePersonComponent>
        </div>
        break;

    //if any inheritants have been added at this point, grandparents are irrelevant!
    case pageState.AskAboutGrandparents:
    if (Inheritants.Count > 0)
    {
        currentState=pageState.Finished;
        StateHasChanged();
        break;
    }
        <div>
        <div>
            <QuestionComponent Text="Har du en eller flere levende biologiske bedsteforældre?"
                OnYes="@(() => {currentState = pageState.AddGrandparents; StateHasChanged();})"
                OnNo="@(() => {currentState = pageState.Finished; StateHasChanged();})">
            </QuestionComponent>
        </div>
        </div>
        break;
    case pageState.AddGrandparents:
        <div>
            <CreatePersonComponent 
                Inheritants = "@Inheritants"
                Text = "Angiv data for biologiske søskende"
                OnFinished = "@(() => {currentState = pageState.Finished; StateHasChanged();})"
                OnCancel = "@(() => {currentState = pageState.AskAboutGrandparents; StateHasChanged();})">
            </CreatePersonComponent>
        </div>
        break;
    case pageState.Finished:
        <div>
            <FluentCard Style="max-width: 500px; min-height: 300px; margin: 20px auto; padding: 20px;overflow: visible;">

            <FluentStack Orientation="Orientation.Vertical" VerticalGap="10">

            <FluentLabel Typo="@Typography.H3" Style="text-align: center; margin-bottom: 20px;">
                Alle arvinger er blevet tilføjet!
                Tryk på knappen nedenfor, for at se fordeling af arv.
            </FluentLabel>

            @* <FluentButton Appearance="Appearance.Accent" OnClick="">
                Gå til arvefordeling!
            </FluentButton> *@
            <FluentStack Orientation="Orientation.Horizontal" HorizontalAlignment="HorizontalAlignment.Center"> 
                <FluentButton Appearance="Appearance.Accent" OnClick="@(() => NavigationManager.NavigateTo("/fordeling"))">
                    Gå til arvefordeling!
                </FluentButton>
            </FluentStack>

            </FluentStack>
            </FluentCard>
        </div>
        break;
}

@code {
    private string createPersonTitle = "";
    private pageState currentState = pageState.AskAboutChildren;
    public enum pageState { AskAboutChildren, AddChildren, AskAboutSpouse, AddSpouse, AskAboutParents, AddParents, AskAboutSiblings, AddSiblings, AskAboutGrandparents, AddGrandparents, Finished}
    public pageState state { get; set; }

    [Parameter]
    public List<Person> Inheritants { get; set; } = new();


    protected override void OnParametersSet()
    {
        currentState = state;
        @* NavigationManager.NavigateTo($"/flow/{state}", false); *@
        @* if (currentStep < 1 || currentStep > lastStep)
        {
            currentStep = 1;
            NavigationManager.NavigateTo("/flow/AskAboutChildren", false);
        } *@
    }

}
